!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("VueResumable",[],t):"object"==typeof exports?exports.VueResumable=t():e.VueResumable=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=3)}([function(e,t){e.exports=function(e,t,n,r,i,a){var u,o=e=e||{},s=typeof e.default;"object"!==s&&"function"!==s||(u=e,o=e.default);var c="function"==typeof o?o.options:o;t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),n&&(c.functional=!0),i&&(c._scopeId=i);var l;if(a?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=l):r&&(l=r),l){var h=c.functional,f=h?c.render:c.beforeCreate;h?(c._injectStyles=l,c.render=function(e,t){return l.call(t),f(e,t)}):c.beforeCreate=f?[].concat(f,l):[l]}return{esModule:u,exports:o,options:c}}},function(e,t,n){"use strict";var r=n(5),i=n(7),a=n(8),u=n(9),o=n(10);t.a={name:"vue-resumable",components:{InputFile:r.a},props:{inputId:{type:String},name:{type:String,default:"file"},requestType:{type:String,default:"octet"},capture:{},multiple:{type:Boolean},accept:{type:String},directory:{type:Boolean},postAction:{type:String},headers:{type:Object,default:Object},data:{type:Object,default:Object},timeout:{type:Number,default:0},progress:{type:Boolean,default:!0},promptly:{type:Boolean,default:!1},thread:{type:Number,default:1},chunkSize:{type:Number,default:0},maxRetries:{type:Number,default:3},carryTypeName:{type:String,default:"resumableType"},carryFileNameName:{type:String,default:"resumableFilename"},carryRelativePathName:{type:String,default:"resumableRelativePath"},carryChunkSizeName:{type:String,default:"resumableChunkSize"},carryCurrentChunkSizeName:{type:String,default:"resumableCurrentChunkSize"},carryTotalSizeName:{type:String,default:"resumableTotalSize"},carryChunkIndexName:{type:String,default:"resumableChunkNumber"},carryTotalChunksName:{type:String,default:"resumableTotalChunks"},carryIdentifierName:{type:String,default:"resumableIdentifier"}},data:function(){return{files:[],features:i.a,uploading:0}},watch:{files:function(){if(this.promptly){this.newFileList().length&&this.upload()}}},methods:{addInputFile:function(e){if(e.files&&e.files.length)for(var t=0;t<e.files.length;t++){var n=e.files[t];this.files.push(new a.a(n,this.maxRetries))}this.$emit("change",this.files)},clear:function(){this.files=[]},_generateUploader:function(e){return new o.a({action:this.postAction,method:"POST",headers:this.headers,data:this.data,file:e,progress:this.progress,requestType:this.requestType,chunk:{thread:this.thread,chunkSize:this.chunkSize,carryChunkSizeName:this.carryChunkSizeName,carryCurrentChunkSizeName:this.carryCurrentChunkSizeName,carryTotalSizeName:this.carryTotalSizeName,carryChunkIndexName:this.carryChunkIndexName,carryTotalChunksName:this.carryTotalChunksName,carryIdentifierName:this.carryIdentifierName},carryTypeName:this.carryTypeName,carryFileNameName:this.carryFileNameName,carryRelativePathName:this.carryRelativePathName})},_getUploaderList:function(){var e=this,t=[];return this.files.forEach(function(n){n.uploading||t.push(e._generateUploader(n))}),t},upload:function(){return new u.a({thread:this.thread,uploaderList:this._getUploaderList(),enableChunk:this.chunkSize}).then(function(e){console.log(e)})}}}},function(e,t,n){"use strict";t.a={methods:{change:function(e){this.$destroy(),this.$parent.addInputFile(e.target),new this.constructor({parent:this.$parent,el:this.$el})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i={install:function(e,t){e.component(r.a.name,r.a)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(i),t.default=i},function(e,t,n){"use strict";var r=n(1),i=n(13),a=n(0),u=a(r.a,i.a,!1,null,null,null);t.a=u.exports},function(e,t,n){"use strict";var r=n(2),i=n(6),a=n(0),u=a(r.a,i.a,!1,null,null,null);t.a=u.exports},function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{attrs:{type:"file",name:e.$parent.name,id:e.$parent.inputId||e.$parent.name,accept:e.$parent.accept,capture:e.$parent.capture,webkitdirectory:e.$parent.directory&&e.$parent.features.directory,directory:e.$parent.directory&&e.$parent.features.directory,multiple:e.$parent.multiple&&e.$parent.features.html5},on:{change:e.change}})},i=[],a={render:r,staticRenderFns:i};t.a=a},function(e,t,n){"use strict";t.a=new function(){var e=document.createElement("input");e.type="file",e.multiple=!0;var t={};return t.html5=window.FormData&&e.files&&!0,t.html5&&(t.directory="boolean"==typeof e.webkitdirectory||"boolean"==typeof e.directory,t.drop=void 0!==e.ondrop),t}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this.file=t,this.name=t.name,this.size=t.size,this.type=t.type,this.relativePath=t.webkitRelativePath||t.relativePath||"",this.lastModified=t.lastModified,this.identifier=this.guid(),this.uploadPercent=0,this.uploading=0,this.retries=n||1,this.maxRetries=n||1,/^image\/*/.test(t.type)&&(this.url=this.getObjectURL(t))}return i(e,[{key:"getObjectURL",value:function(e){var t=null;return void 0!==window.createObjectURL?t=window.createObjectURL(e):void 0!==window.URL?t=window.URL.createObjectURL(e):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}},{key:"guid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),e}();t.a=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){var n=this;r(this,e),this.thread=t.thread,this.uploaderList=t.uploaderList,this.enableChunk=t.enableChunk;var i=null,a=null;return new Promise(function(e){(i=n.enableChunk?function(){a=n._getNotStartUploader(),a.length?a[0].send().then(function(){return i()}).catch(function(){return i()}):e(n.uploaderList)}:function(){if(a=n._getNotStartUploader(),a.length)for(var t=n.thread>a.length?a.length:n.thread,r=0;r<t-n._getUploadingList();r++)a[r].send().then(function(){return i()}).catch(function(){return i()});else e(n.uploaderList)})()})}return i(e,[{key:"_getNotStartUploader",value:function(){var e=[];return this.uploaderList.forEach(function(t){t.file.uploading||e.push(t)}),e}},{key:"_getUploadingList",value:function(){var e=[];return this.uploaderList.forEach(function(t){1===t.file.uploading&&e.push(t)}),e}}]),e}();t.a=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(11),a=n(12),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.action=t.action,this.method=t.method,this.headers=t.headers,this.data=t.data,this.file=t.file,this.progress=t.progress,this.requestType=t.requestType,this.thread=t.chunk.thread,this.chunkSize=1024*t.chunk.chunkSize,this.carryParamName={typeName:t.carryTypeName,fileNameName:t.carryFileNameName,relativePathName:t.carryRelativePathName,chunkSizeName:t.chunk.carryChunkSizeName,currentChunkSizeName:t.chunk.carryCurrentChunkSizeName,totalSizeName:t.chunk.carryTotalSizeName,chunkIndexName:t.chunk.carryChunkIndexName,totalChunksName:t.chunk.carryTotalChunksName,identifierName:t.chunk.carryIdentifierName}}return u(e,[{key:"_getCommonArguments",value:function(e){var t={};return t[this.carryParamName.typeName]=this.file.type,t[this.carryParamName.fileNameName]=this.file.name,t[this.carryParamName.relativePathName]=this.file.relativePath,t[this.carryParamName.totalSizeName]=this.file.size,t[this.carryParamName.chunkSizeName]=e.chunkSize,t[this.carryParamName.currentChunkSizeName]=e.currentChunkSize,t[this.carryParamName.chunkIndexName]=e.chunkIndex,t[this.carryParamName.totalChunksName]=e.totalChunks,t[this.carryParamName.identifierName]=this.file.identifier,t}},{key:"send",value:function(){if(!this.file.uploading)return this.chunkSize&&this.file.size>this.chunkSize?this._chunkUploadSend():this._entiretyUpload()}},{key:"_setBodyFields",value:function(e,t){return Object.keys(t).forEach(function(n){return e.append(n,t[n])}),e}},{key:"_entiretyUpload",value:function(){var e=this,t=this.requestOptions;this.progress&&(t.progress=function(t){t.lengthComputable?e.file.uploadPercent=Math.round(100*t.loaded/t.total):e.file.uploadPercent=0});var n=function(){return e.file.uploading=1,Object(i.a)(t).then(function(t,n){return e.file.uploading=2,e.file.xhr=t,e.file.event=n,e.file}).catch(function(t){if(!e.file.retries)return e.file.event=t,e.file.uploading=-1,e.file;--e.file.retries,e.file.uploading=0,e.send()})},r=Object.assign({},this._getCommonArguments({chunkSize:this.file.size,currentChunkSize:this.file.size,chunkIndex:1,totalChunks:1}),this.data);return"octet"===this.requestType?(t.query=r,new Promise(function(r){var i=new FileReader;i.onload=function(){t.data=i.result,r(n())},i.readAsDataURL(e.file.file)})):(r[this.file.name]=this.file.file,t.data=this._setBodyFields(new FormData,r),n())}},{key:"_createChunkOptions",value:function(e,t,n,r){var i=this,u=Object.assign({},this.requestOptions);this.progress&&(u.progress=function(e){if(e.lengthComputable){var t=i._filterChunkList(a.c).length;i.file.uploadPercent=Math.floor(100/i.chunks.length*t)+Math.floor(100*e.loaded/i.file.size)}});var o=Object.assign(this._getCommonArguments({chunkSize:this.chunkSize,currentChunkSize:e.size,chunkIndex:t+1,totalChunks:1}),this.data,{start:n,end:r});return"octet"===this.requestType?(u.query=o,u.data=e):(o[this.file.name]=e,u.data=this._setBodyFields(new FormData,o)),u}},{key:"_createChunks",value:function(){this.chunks=[];for(var e=0,t=0,n=this.chunkSize;t<this.file.size;){var r=this.file.file.slice(t,n),i={index:e,blob:r,startOffset:t,uploading:a.b,retries:this.file.maxRetries};i.options=this._createChunkOptions(i.blob,e,t,n),this.chunks.push(i),e++,t=n,n=t+this.chunkSize}var u=this;this.chunks.forEach(function(t){t.total=e,"octet"===u.requestType?t.options.query[u.carryParamName.totalChunksName]=e:t.options.data.append(u.carryParamName.totalChunksName,e)})}},{key:"_setFileUploadResult",value:function(e,t,n){this.file.chunk||(this.file.chunk={xhr:{},event:{}}),n&&(this.file.chunk.xhr[e.index]=n),t&&(this.file.chunk.event[e.index]=t),Object.keys(this.file.chunk.xhr).length===e.total&&(this.file.uploading=a.c)}},{key:"_sendChunk",value:function(e){var t=this;if(!e.uploading)return e.uploading=a.d,Object(i.a)(e.options).then(function(n,r){e.uploading=a.c,t._setFileUploadResult(e,r,n)}).catch(function(n){e.retries?(--e.retries,e.uploading=a.b,t._sendChunk(e)):(e.uploading=a.a,t.file.uploading=a.a,t.file.uploadPercent=0,t._setFileUploadResult(e,n))})}},{key:"_filterChunkList",value:function(e){var t=[];return 0===e&&this.file.uploading<0?t:(this.chunks.forEach(function(n){n.uploading===e&&t.push(n)}),t)}},{key:"_sendChunkQueue",value:function(){var e=this;return new Promise(function(t){!function n(){var r=e._filterChunkList(a.b);if(!r.length)return void t(e.file);var i=r.length>e.thread?e.thread:r.length;if(!((i-=e._filterChunkList(a.d))<=0))for(var u=0;u<i;u++)e._sendChunk(r[u]).then(function(){var t=e._filterChunkList(a.c).length;if(t===e.chunks.length)return void(e.file.uploadPercent=100);e.file.uploadPercent=Math.floor(100/e.chunks.length*t),n()}).catch(function(){return n()})}()})}},{key:"_chunkUploadSend",value:function(){return this._createChunks(),this.file.uploading=a.d,this._sendChunkQueue()}},{key:"requestOptions",get:function(){return{action:this.action,method:this.method,headers:this.headers}}}]),e}();t.a=o},function(e,t,n){"use strict";var r=function(e,t){if(t){var n=[];Object.keys(t).forEach(function(e){n.push([encodeURIComponent(e),encodeURIComponent(t[e])].join("="))}),n.length&&(e+=e.match("\\?")?"&":"?"+n.join("&"))}return e};t.a=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest,a=e.query?r(e.action,e.query):e.action;e.progress&&i.upload.addEventListener("progress",e.progress,!1);var u=function(e){i.status>=200&&i.status<300?t(i,e):n(e)};i.addEventListener("load",u,!1),i.addEventListener("error",u,!1),i.addEventListener("abort",u,!1),i.addEventListener("timeout",u,!1),i.open(e.method,a),Object.keys(e.headers).forEach(function(t){return i.setRequestHeader(t,e.headers[t])}),i.send(e.data)})}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return a}),n.d(t,"c",function(){return u});var r=-1,i=0,a=1,u=2},function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("label",{staticClass:"className"},[e._t("default"),e._v(" "),n("input-file")],2)},i=[],a={render:r,staticRenderFns:i};t.a=a}])});
//# sourceMappingURL=vue-resumable.js.map