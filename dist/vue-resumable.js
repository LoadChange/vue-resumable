!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("VueResumable",[],t):"object"==typeof exports?exports.VueResumable=t():e.VueResumable=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);function i(e,t,n,i,r,a,u,o){var s=typeof(e=e||{}).default;"object"!==s&&"function"!==s||(e=e.default);var l,h="function"==typeof e?e.options:e;if(t&&(h.render=t,h.staticRenderFns=n,h._compiled=!0),i&&(h.functional=!0),a&&(h._scopeId=a),u?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(u)},h._ssrRegister=l):r&&(l=o?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(h.functional){h._injectStyles=l;var c=h.render;h.render=function(e,t){return l.call(t),c(e,t)}}else{var f=h.beforeCreate;h.beforeCreate=f?[].concat(f,l):[l]}return{exports:e,options:h}}var r=i({methods:{change:function(e){this.$destroy(),this.$parent.addInputFile(e.target),new this.constructor({parent:this.$parent,el:this.$el})}}},function(){var e=this,t=e.$createElement;return(e._self._c||t)("input",{attrs:{type:"file",name:e.$parent.name,id:e.$parent.inputId||e.$parent.name,accept:e.$parent.accept,capture:e.$parent.capture,webkitdirectory:e.$parent.directory&&e.$parent.features.directory,directory:e.$parent.directory&&e.$parent.features.directory,multiple:e.$parent.multiple&&e.$parent.features.html5},on:{change:e.change}})},[],!1,null,null,null).exports,a=new function(){var e=document.createElement("input");e.type="file",e.multiple=!0;var t={};return t.html5=window.FormData&&e.files&&!0,t.html5&&(t.directory="boolean"==typeof e.webkitdirectory||"boolean"==typeof e.directory,t.drop=void 0!==e.ondrop),t},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=t,this.name=t.name,this.size=t.size,this.type=t.type,this.relativePath=t.webkitRelativePath||t.relativePath||"",this.lastModified=t.lastModified,this.identifier=this.guid(),this.uploadPercent=0,this.uploading=0,this.retries=n||1,this.maxRetries=n||1,/^image\/*/.test(t.type)&&(this.url=this.getObjectURL(t))}return u(e,[{key:"getObjectURL",value:function(e){var t=null;return void 0!==window.createObjectURL?t=window.createObjectURL(e):void 0!==window.URL?t=window.URL.createObjectURL(e):void 0!==window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}},{key:"guid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),e}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var l=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.thread=t.thread,this.uploaderList=t.uploaderList,this.enableChunk=t.enableChunk;var i=null,r=null;return new Promise(function(e){(i=n.enableChunk?function(){(r=n._getNotStartUploader()).length?r[0].send().then(function(){return i()}).catch(function(){return i()}):e(n.uploaderList)}:function(){if((r=n._getNotStartUploader()).length)for(var t=n.thread>r.length?r.length:n.thread,a=0;a<t-n._getUploadingList();a++)r[a].send().then(function(){return i()}).catch(function(){return i()});else e(n.uploaderList)})()})}return s(e,[{key:"_getNotStartUploader",value:function(){var e=[];return this.uploaderList.forEach(function(t){t.file.uploading||e.push(t)}),e}},{key:"_getUploadingList",value:function(){var e=[];return this.uploaderList.forEach(function(t){1===t.file.uploading&&e.push(t)}),e}}]),e}(),h=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest,r=e.query?function(e,t){if(t){var n=[];Object.keys(t).forEach(function(e){n.push([encodeURIComponent(e),encodeURIComponent(t[e])].join("="))}),n.length&&(e+=e.match("\\?")?"&":"?"+n.join("&"))}return e}(e.action,e.query):e.action;e.progress&&i.upload.addEventListener("progress",e.progress,!1);var a=function(e){i.status>=200&&i.status<300?t(i,e):n(e)};i.addEventListener("load",a,!1),i.addEventListener("error",a,!1),i.addEventListener("abort",a,!1),i.addEventListener("timeout",a,!1),i.open(e.method,r),Object.keys(e.headers).forEach(function(t){return i.setRequestHeader(t,e.headers[t])}),i.send(e.data)})},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t.action,this.method=t.method,this.headers=t.headers,this.data=t.data,this.file=t.file,this.progress=t.progress,this.requestType=t.requestType,this.thread=t.chunk.thread,this.chunkSize=1024*t.chunk.chunkSize,this.chunkFormat=t.chunk.chunkFormat,this.carryParamName={typeName:t.carryTypeName,fileNameName:t.carryFileNameName,relativePathName:t.carryRelativePathName,chunkSizeName:t.chunk.carryChunkSizeName,currentChunkSizeName:t.chunk.carryCurrentChunkSizeName,totalSizeName:t.chunk.carryTotalSizeName,chunkIndexName:t.chunk.carryChunkIndexName,totalChunksName:t.chunk.carryTotalChunksName,identifierName:t.chunk.carryIdentifierName}}return c(e,[{key:"_getCommonArguments",value:function(e){var t={};return t[this.carryParamName.typeName]=this.file.type,t[this.carryParamName.fileNameName]=this.file.name,t[this.carryParamName.relativePathName]=this.file.relativePath||"/",t[this.carryParamName.totalSizeName]=this.file.size,t[this.carryParamName.chunkSizeName]=e.chunkSize,t[this.carryParamName.currentChunkSizeName]=e.currentChunkSize,t[this.carryParamName.chunkIndexName]=e.chunkIndex,t[this.carryParamName.totalChunksName]=e.totalChunks,t[this.carryParamName.identifierName]=this.file.identifier,t}},{key:"send",value:function(){if(!this.file.uploading)return this.chunkSize&&this.file.size>this.chunkSize?this._chunkUploadSend():this._entiretyUpload()}},{key:"_setBodyFields",value:function(e,t){return Object.keys(t).forEach(function(n){return e.append(n,t[n])}),e}},{key:"_entiretyUpload",value:function(){var e=this,t=this.requestOptions;this.progress&&(t.progress=function(t){t.lengthComputable?e.file.uploadPercent=Math.round(100*t.loaded/t.total):e.file.uploadPercent=0});var n=function(){return e.file.uploading=1,h(t).then(function(t,n){return e.file.uploading=2,e.file.xhr=t,e.file.event=n,e.file}).catch(function(t){if(!e.file.retries)return e.file.event=t,e.file.uploading=-1,e.file;--e.file.retries,e.file.uploading=0,e.send()})},i=Object.assign({},this._getCommonArguments({chunkSize:this.file.size,currentChunkSize:this.file.size,chunkIndex:1,totalChunks:1}),this.data);if("octet"===this.requestType){var r={"Content-Type":"application/octet-stream"};return t.headers?t.headers.push(r):t.headers=r,t.query=i,"blob"===this.chunkFormat?(t.data=this.file.file.slice(0,this.file.file.size),n()):new Promise(function(i){var r=new FileReader;r.onload=function(){t.data=r.result,i(n())},r.readAsDataURL(e.file.file)})}return i[this.file.name]=this.file.file,t.data=this._setBodyFields(new FormData,i),n()}},{key:"_createChunkOptions",value:function(e,t,n,i){var r=this,a=Object.assign({},this.requestOptions);this.progress&&(a.progress=function(e){if(e.lengthComputable){var t=r._filterChunkList(2).length;r.file.uploadPercent=Math.floor(100/r.chunks.length*t)+Math.floor(100*e.loaded/r.file.size)}});var u=Object.assign(this._getCommonArguments({chunkSize:this.chunkSize,currentChunkSize:e.size,chunkIndex:t+1,totalChunks:1}),this.data,{start:n,end:i});if("octet"===this.requestType){var o={"Content-Type":"application/octet-stream"};a.headers?a.headers.push(o):a.headers=o,a.query=u,a.data=e}else u[this.file.name]=e,a.data=this._setBodyFields(new FormData,u);return a}},{key:"_createChunks",value:function(){this.chunks=[];for(var e=0,t=0,n=this.chunkSize;t<this.file.size;){var i=this.file.file.slice(t,n),r={index:e,blob:i,startOffset:t,uploading:0,retries:this.file.maxRetries};r.options=this._createChunkOptions(r.blob,e,t,n),this.chunks.push(r),e++,n=(t=n)+this.chunkSize}var a=this;this.chunks.forEach(function(t){t.total=e,"octet"===a.requestType?t.options.query[a.carryParamName.totalChunksName]=e:t.options.data.append(a.carryParamName.totalChunksName,e)})}},{key:"_setFileUploadResult",value:function(e,t,n){this.file.chunk||(this.file.chunk={xhr:{},event:{}}),n&&(this.file.chunk.xhr[e.index]=n),t&&(this.file.chunk.event[e.index]=t),Object.keys(this.file.chunk.xhr).length===e.total&&(this.file.uploading=2)}},{key:"_sendChunk",value:function(e){var t=this;if(!e.uploading)return e.uploading=1,h(e.options).then(function(n,i){e.uploading=2,t._setFileUploadResult(e,i,n)}).catch(function(n){e.retries?(--e.retries,e.uploading=0,t._sendChunk(e)):(e.uploading=-1,t.file.uploading=-1,t.file.uploadPercent=0,t._setFileUploadResult(e,n))})}},{key:"_filterChunkList",value:function(e){var t=[];return 0===e&&this.file.uploading<0?t:(this.chunks.forEach(function(n){n.uploading===e&&t.push(n)}),t)}},{key:"_sendChunkQueue",value:function(){var e=this;return new Promise(function(t){!function n(){var i=e._filterChunkList(0);if(i.length){var r=i.length>e.thread?e.thread:i.length;if(!((r-=e._filterChunkList(1))<=0))for(var a=0;a<r;a++)e._sendChunk(i[a]).then(function(){var t=e._filterChunkList(2).length;t!==e.chunks.length?(e.file.uploadPercent=Math.floor(100/e.chunks.length*t),n()):e.file.uploadPercent=100}).catch(function(){return n()})}else t(e.file)}()})}},{key:"_chunkUploadSend",value:function(){return this._createChunks(),this.file.uploading=1,this._sendChunkQueue()}},{key:"requestOptions",get:function(){return{action:this.action,method:this.method,headers:this.headers}}}]),e}(),d=i({name:"vue-resumable",components:{InputFile:r},props:{inputId:{type:String},name:{type:String,default:"file"},requestType:{type:String,default:"octet"},capture:{},multiple:{type:Boolean},accept:{type:String},directory:{type:Boolean},postAction:{type:String},headers:{type:Object},data:{type:Object},timeout:{type:Number,default:0},progress:{type:Boolean,default:!0},promptly:{type:Boolean,default:!1},thread:{type:Number,default:1},chunkSize:{type:Number,default:0},chunkFormat:{type:String,default:"blob"},maxRetries:{type:Number,default:3},carryTypeName:{type:String,default:"resumableType"},carryFileNameName:{type:String,default:"resumableFilename"},carryRelativePathName:{type:String,default:"resumableRelativePath"},carryChunkSizeName:{type:String,default:"resumableChunkSize"},carryCurrentChunkSizeName:{type:String,default:"resumableCurrentChunkSize"},carryTotalSizeName:{type:String,default:"resumableTotalSize"},carryChunkIndexName:{type:String,default:"resumableChunkNumber"},carryTotalChunksName:{type:String,default:"resumableTotalChunks"},carryIdentifierName:{type:String,default:"resumableIdentifier"}},data:function(){return{files:[],features:a,uploading:0}},watch:{files:function(){this.promptly&&this.upload()}},methods:{selectFile:function(){this.inputId&&document.getElementById(this.inputId).click()},addInputFile:function(e){if(e.files&&e.files.length)for(var t=0;t<e.files.length;t++){var n=e.files[t];this.files.push(new o(n,this.maxRetries))}this.$emit("change",this.files)},clear:function(){this.files=[]},_generateUploader:function(e){return new f({action:this.postAction,method:"POST",headers:this.headers,data:this.data,file:e,progress:this.progress,requestType:this.requestType,chunk:{thread:this.thread,chunkSize:this.chunkSize,chunkFormat:this.chunkFormat,carryChunkSizeName:this.carryChunkSizeName,carryCurrentChunkSizeName:this.carryCurrentChunkSizeName,carryTotalSizeName:this.carryTotalSizeName,carryChunkIndexName:this.carryChunkIndexName,carryTotalChunksName:this.carryTotalChunksName,carryIdentifierName:this.carryIdentifierName},carryTypeName:this.carryTypeName,carryFileNameName:this.carryFileNameName,carryRelativePathName:this.carryRelativePathName})},_getUploaderList:function(){var e=this,t=[];return this.files.forEach(function(n){n.uploading||t.push(e._generateUploader(n))}),t},upload:function(){var e=this,t={thread:this.thread,uploaderList:this._getUploaderList(),enableChunk:this.chunkSize};function n(){e.$emit("complete",e.files)}return this.uploading?new Promise(function(t){e.__uploadingTime__=setInterval(function(){e.uploading||(n(),window.clearInterval(e.__uploadingTime__),t())},333)}).then(function(){return new l(t).then(function(){return e.uploading=0})}):new l(t).then(function(){n(),e.uploading=0})}}},function(){var e=this.$createElement,t=this._self._c||e;return t("label",{staticClass:"vue-resumable"},[this._t("default"),this._v(" "),t("input-file")],2)},[],!1,null,null,null).exports,p={install:function(e,t){e.component(d.name,d)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(p);t.default=p}])});
//# sourceMappingURL=vue-resumable.js.map